<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Controle da Moto - Empresa</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #e7ecf0;
    margin: 0; padding: 0;
    color: #333;
    display: flex;
    justify-content: center;
    min-height: 100vh;
    align-items: flex-start;
    padding-top: 40px;
  }
  .container {
    background: #fff;
    width: 100%;
    max-width: 480px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    overflow: hidden;
  }
  header {
    background: #2c7be5;
    color: white;
    padding: 16px 24px;
    text-align: center;
    font-weight: 700;
    font-size: 1.5em;
    user-select: none;
  }
  nav {
    display: flex;
    background: #f4f7fa;
    border-bottom: 1px solid #ddd;
    flex-wrap: wrap;
  }
  nav button {
    flex: 1 1 100px;
    padding: 14px 0;
    border: none;
    background: transparent;
    font-weight: 600;
    cursor: pointer;
    font-size: 1em;
    color: #555;
    transition: background-color 0.3s, color 0.3s;
  }
  nav button.active {
    background: #2c7be5;
    color: white;
    font-weight: 700;
    box-shadow: inset 0 -3px 0 white;
  }
  main {
    padding: 20px 24px;
  }
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }
  label {
    display: block;
    margin: 12px 0 6px;
    font-weight: 600;
  }
  input[type="text"], input[type="number"], input[type="password"], textarea, select {
    width: 100%;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 1em;
    box-sizing: border-box;
    resize: vertical;
    font-family: inherit;
  }
  textarea {
    min-height: 70px;
  }
  button.save-btn {
    margin-top: 16px;
    background-color: #2c7be5;
    border: none;
    color: white;
    padding: 12px;
    border-radius: 8px;
    font-size: 1.1em;
    font-weight: 700;
    cursor: pointer;
    width: 100%;
    transition: background-color 0.25s;
  }
  button.save-btn:hover {
    background-color: #1a5fc1;
  }
  .login-card {
    max-width: 380px;
    margin: auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    padding: 24px;
    text-align: center;
  }
  .login-card input {
    margin-top: 12px;
    padding: 12px;
    font-size: 1.1em;
    width: 100%;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  .login-card button {
    margin-top: 20px;
    background: #2c7be5;
    border: none;
    color: white;
    font-weight: 700;
    padding: 14px;
    width: 100%;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.1em;
    transition: background-color 0.3s;
  }
  .login-card button:hover {
    background: #1a5fc1;
  }
  .error-msg {
    color: red;
    margin-top: 10px;
    display: none;
    font-weight: 600;
  }
  .logout-btn {
    background: transparent;
    border: none;
    color: #2c7be5;
    font-weight: 700;
    cursor: pointer;
    font-size: 0.9em;
    margin: 8px 24px 0 24px;
    text-decoration: underline;
    padding: 0;
    align-self: flex-end;
  }
</style>
</head>
<body>
  <div id="loginScreen" class="login-card">
    <h2>Login</h2>
    <input type="text" id="loginUser" placeholder="Usuário" autocomplete="off" />
    <input type="password" id="loginPass" placeholder="Senha" autocomplete="off" />
    <button onclick="login()">Entrar</button>
    <div id="loginError" class="error-msg">Usuário ou senha incorretos.</div>
  </div>

  <div id="app" style="display:none;" class="container" >
    <button class="logout-btn" onclick="logout()">Sair</button>
    <header>Controle da Moto</header>
    <nav>
      <button class="tab-btn active" data-tab="inicio">Iniciar Viagem</button>
      <button class="tab-btn" data-tab="finalizar">Finalizar Viagem</button>
      <button class="tab-btn" data-tab="abastecimento">Abastecimento</button>
      <button class="tab-btn" data-tab="manutencao">Manutenção</button>
      <button class="tab-btn" data-tab="ocorrencia">Ocorrência</button>
      <button class="tab-btn" data-tab="historico">Histórico</button>
    </nav>

    <main>
      <!-- Iniciar Viagem -->
      <section id="inicio" class="tab-content active">
        <label>Data e Hora Atual</label>
        <input type="text" id="dataHoraInicio" readonly />

        <label for="kmInicial">Quilometragem Inicial</label>
        <input type="number" id="kmInicial" min="0" />

        <button class="save-btn" onclick="salvarInicio()">Iniciar Viagem</button>
      </section>

      <!-- Finalizar Viagem -->
      <section id="finalizar" class="tab-content">
        <label for="kmFinal">Quilometragem Final</label>
        <input type="number" id="kmFinal" min="0" />

        <button class="save-btn" onclick="salvarFinal()">Finalizar Viagem</button>
      </section>

      <!-- Abastecimento -->
      <section id="abastecimento" class="tab-content">
        <form id="formAbastecimento">
          <label for="litros">Litros</label>
          <input type="number" id="litros" min="0" step="0.1" required />

          <label for="valorLitro">Valor por Litro (R$)</label>
          <input type="number" id="valorLitro" min="0" step="0.01" required />

          <button type="submit" class="save-btn">Salvar Abastecimento</button>
        </form>
      </section>

      <!-- Manutenção -->
      <section id="manutencao" class="tab-content">
        <form id="formManutencao">
          <label for="tipoManutencao">Tipo de Manutenção</label>
          <input type="text" id="tipoManutencao" required />

          <label for="detalhesManutencao">Detalhes</label>
          <textarea id="detalhesManutencao" rows="3"></textarea>

          <button type="submit" class="save-btn">Salvar Manutenção</button>
        </form>
      </section>

      <!-- Ocorrência -->
      <section id="ocorrencia" class="tab-content">
        <form id="formOcorrencia">
          <label for="descricaoOcorrencia">Descrição da Ocorrência</label>
          <textarea id="descricaoOcorrencia" rows="4" required></textarea>

          <button type="submit" class="save-btn">Salvar Ocorrência</button>
        </form>
      </section>

      <!-- Histórico -->
      <section id="historico" class="tab-content">
        <div id="listaRegistros"></div>
      </section>

    </main>
  </div>

<script>
  // Cria usuário padrão se não existir
  function initUsuarios() {
    if(!localStorage.getItem('usuarios_moto')){
      const usuarios = [{usuario:'guimlherme', senha:'523446'}];
      localStorage.setItem('usuarios_moto', JSON.stringify(usuarios));
    }
  }

  // Login
  function login(){
    const user = document.getElementById('loginUser').value.trim();
    const pass = document.getElementById('loginPass').value.trim();
    const users = JSON.parse(localStorage.getItem('usuarios_moto') || '[]');
    const errDiv = document.getElementById('loginError');
    console.log('Tentativa login:', user, pass, users);
    const valido = users.find(u => u.usuario === user && u.senha === pass);
    if(valido){
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('app').style.display = 'flex';
      errDiv.style.display = 'none';
      carregarDataHoraAtual();
      carregarRegistros();
    } else {
      errDiv.style.display = 'block';
    }
  }

  // Logout
  function logout(){
    document.getElementById('app').style.display = 'none';
    document.getElementById('loginScreen').style.display = 'block';
    document.getElementById('loginUser').value = '';
    document.getElementById('loginPass').value = '';
  }

  // Troca de abas
  const tabButtons = document.querySelectorAll('nav button.tab-btn');
  const tabContents = document.querySelectorAll('section.tab-content');
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.getAttribute('data-tab');
      document.getElementById(tab).classList.add('active');
    });
  });

  // Data e hora atual para iniciar viagem
  function carregarDataHoraAtual(){
    const input = document.getElementById('dataHoraInicio');
    const now = new Date();
    input.value = now.toLocaleString('pt-BR');
  }

  // Salvar início da viagem
  function salvarInicio(){
    const kmInicial = parseFloat(document.getElementById('kmInicial').value);
    if(isNaN(kmInicial) || kmInicial < 0){
      alert('Informe uma quilometragem inicial válida.');
      return;
    }
    const dataHoraInicio = document.getElementById('dataHoraInicio').value;
    const viagem = {
      inicio: dataHoraInicio,
      kmInicial: kmInicial,
      kmFinal: null,
      finalizada: false,
      data: dataHoraInicio.split(' ')[0] // só a data
    };
    let viagens = JSON.parse(localStorage.getItem('viagens') || '[]');
    viagens.push(viagem);
    localStorage.setItem('viagens', JSON.stringify(viagens));
    alert('Viagem iniciada!');
    // Limpa campo kmInicial
    document.getElementById('kmInicial').value = '';
    carregarRegistros();
  }

  // Salvar final da viagem
  function salvarFinal(){
    const kmFinal = parseFloat(document.getElementById('kmFinal').value);
    if(isNaN(kmFinal) || kmFinal < 0){
      alert('Informe uma quilometragem final válida.');
      return;
    }
    let viagens = JSON.parse(localStorage.getItem('viagens') || '[]');
    // Encontra a última viagem não finalizada
    const viagemAberta = viagens.find(v => !v.finalizada);
    if(!viagemAberta){
      alert('Nenhuma viagem aberta para finalizar.');
      return;
    }
    if(kmFinal < viagemAberta.kmInicial){
      alert('Quilometragem final não pode ser menor que a inicial.');
      return;
    }
    viagemAberta.kmFinal = kmFinal;
    viagemAberta.finalizada = true;
    localStorage.setItem('viagens', JSON.stringify(viagens));
    alert('Viagem finalizada!');
    document.getElementById('kmFinal').value = '';
    carregarRegistros();
  }

  // Mostrar histórico de viagens
  function carregarRegistros(){
    const div = document.getElementById('listaRegistros');
    let viagens = JSON.parse(localStorage.getItem('viagens') || '[]');
    if(viagens.length === 0){
      div.innerHTML = '<p>Nenhum registro encontrado.</p>';
      return;
    }
    let html = '<table><thead><tr><th>Data</th><th>KM Inicial</th><th>KM Final</th><th>Status</th></tr></thead><tbody>';
    viagens.forEach(v => {
      html += `<tr>
        <td>${v.data}</td>
        <td>${v.kmInicial}</td>
        <td>${v.kmFinal !== null ? v.kmFinal : '-'}</td>
        <td>${v.finalizada ? 'Finalizada' : 'Aberta'}</td>
      </tr>`;
    });
    html += '</tbody></table>';
    div.innerHTML = html;
  }

  // Inicia tudo
  window.onload = () => {
    initUsuarios();
  }
</script>
</body>
</html>
